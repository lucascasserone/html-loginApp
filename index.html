<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heuriskien | Enterprise v11.9</title>
    
    <!-- CSS FRAMEWORKS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- LIBRARIES -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- CUSTOM CSS -->
    <link rel="stylesheet" href="./css/styles.css">
    
    <script>
        // Armazena Supabase globalmente para acesso - remove ap√≥s implementar import maps
        // TODO: Refatorar para ES modules com import maps quando suportar
    </script>
</head>
<body :class="'theme-' + theme" x-data="systemCore()" x-init="init()">
    
    <!-- SCRIPT PARA CAPTURAR ERROS DO ALPINE -->
    <script>
        // Captura erros n√£o tratados e mostra no console
        window.addEventListener('error', (event) => {
            console.error('‚ùå Erro n√£o tratado:', event.error);
        });
    </script>

    <!-- SPLASH SCREEN -->
    <div x-show="!initialized" class="fixed inset-0 bg-slate-950 z-[100] flex flex-col items-center justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
        <h2 class="text-blue-500 font-black tracking-widest text-xs uppercase">Heuriskien Intelligence</h2>
    </div>

    <!-- LOGIN VIEW -->
    <template x-if="view === 'login'">
        <div class="login-view min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
            <div class="w-full max-w-[420px] glass-container p-12 rounded-[40px] fade-in shadow-2xl">
                <div class="text-center mb-10">
                    <h1 class="text-4xl font-black italic tracking-tighter">HEURISKIEN</h1>
                    <p class="text-[10px] font-bold text-blue-500 uppercase tracking-[0.3em]">Enterprise Intelligence</p>
                </div>
                <form @submit.prevent="handleLogin()" x-data="{ showPass: false, isLoading: false }" class="space-y-5">
                    <div>
                        <label for="email" class="block text-xs font-black uppercase mb-2 opacity-50">E-mail Corporativo</label>
                        <input id="email" type="email" x-model="email" @blur="$el.classList.toggle('border-red-500', !$el.checkValidity())" placeholder="seu@email.com" class="w-full px-6 py-5 rounded-2xl input-premium border-white/10 text-white" aria-label="E-mail corporativo" required>
                    </div>
                    <div>
                        <label for="password" class="block text-xs font-black uppercase mb-2 opacity-50">Senha</label>
                        <div class="relative">
                            <input id="password" :type="showPass ? 'text' : 'password'" x-model="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-6 py-5 rounded-2xl input-premium border-white/10 pr-14 text-white" aria-label="Senha de acesso" required>
                            <button type="button" @click="showPass = !showPass" aria-label="Alternar visibilidade da senha" class="absolute right-5 top-1/2 -translate-y-1/2 opacity-40 hover:opacity-100 transition text-white" title="Mostrar/Ocultar senha">
                                <span x-text="showPass ? 'üëÅÔ∏è' : 'üôà'" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button type="button" @click="recoverPassword()" class="text-[10px] font-black uppercase tracking-widest text-blue-500 hover:text-blue-400 transition">Esqueceu a senha?</button>
                    </div>
                    <button type="submit" :disabled="isLoading" class="w-full bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 text-white py-5 rounded-2xl font-black uppercase text-xs tracking-widest shadow-lg shadow-blue-600/20 transition">
                        <span x-text="isLoading ? 'Acessando...' : 'Acessar Hub'"></span>
                    </button>
                </form>
            </div>
        </div>
    </template>

    <!-- DASHBOARD VIEW -->
    <template x-if="view === 'dashboard'">
        <div x-cloak>
            <!-- NAVBAR - NOVO DESIGN -->
            <nav class="bg-gradient-to-r from-slate-900 via-slate-900 to-blue-900/20 backdrop-blur-xl px-8 py-4 flex justify-between items-center sticky top-0 z-40 border-b border-blue-500/10 shadow-lg shadow-blue-500/5">
                
                <!-- LOGO + BRAND -->
                <div class="flex items-center gap-6 min-w-fit">
                    <div class="flex items-baseline gap-1">
                        <h1 class="font-black text-xl italic tracking-tighter text-white">HEURIS</h1>
                        <h1 class="font-black text-xl italic tracking-tighter text-blue-400">KIEN</h1>
                    </div>
                    <div class="h-6 w-px bg-blue-500/30"></div>
                </div>

                <!-- NAVIGATION TABS - CENTRO -->
                <div 
                    class="nav-menu-section flex gap-1 bg-slate-800/40 px-2 py-1.5 rounded-xl border border-slate-700/50"
                    :class="mobileMenuOpen ? 'mobile-menu-open' : ''"
                    @click:away="mobileMenuOpen = false">
                    <template x-for="t in ['news', 'reports', 'users', 'audit', 'profile']">
                        <button 
                            x-show="t !== 'audit' || isAdmin" 
                            @click="tab = t; mobileMenuOpen = false"
                            :class="tab === t 
                                ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/30' 
                                : 'text-slate-400 hover:text-slate-200 hover:bg-slate-700/30'" 
                            class="px-4 py-1.5 rounded-lg text-sm font-bold uppercase tracking-wider transition-all duration-200 whitespace-nowrap"
                            :title="t === 'users' ? 'Equipe' : (t === 'news' ? 'Not√≠cias' : (t === 'reports' ? 'Relat√≥rios' : t))">
                            <span x-text="t === 'users' ? 'üë• Equipe' : (t === 'news' ? 'üì∞ Not√≠cias' : (t === 'reports' ? 'üìä Reports' : (t === 'audit' ? 'üìã Auditoria' : 'üë§ Perfil')))"></span>
                        </button>
                    </template>
                </div>

                <!-- CONTROLES - DIREITA -->
                <div 
                    class="nav-controls-section flex items-center gap-3"
                    :class="mobileMenuOpen ? 'mobile-menu-open' : ''"
                    @click:away="mobileMenuOpen = false">
                    <!-- TEMA SELECTOR - REDESENHADO -->
                    <div class="flex items-center gap-2 bg-slate-800/40 px-2 py-1.5 rounded-xl border border-slate-700/50">
                        <button 
                            @click="theme = 'dark'; localStorage.setItem('heuriskien_theme', 'dark')" 
                            :class="theme === 'dark' ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/30' : 'text-slate-400 hover:text-slate-200'"
                            class="p-1.5 rounded-lg transition-all duration-200" 
                            title="Tema escuro">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        </button>
                        <button 
                            @click="theme = 'light'; localStorage.setItem('heuriskien_theme', 'light')" 
                            :class="theme === 'light' ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/30' : 'text-slate-400 hover:text-slate-200'"
                            class="p-1.5 rounded-lg transition-all duration-200" 
                            title="Tema claro">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l1.414 1.414a1 1 0 001.414-1.414l-1.414-1.414a1 1 0 00-1.414 1.414zm0-7.778l1.414-1.414a1 1 0 10-1.414-1.414l-1.414 1.414a1 1 0 001.414 1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                        <button 
                            @click="theme = 'glass'; localStorage.setItem('heuriskien_theme', 'glass')" 
                            :class="theme === 'glass' ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/30' : 'text-slate-400 hover:text-slate-200'"
                            class="p-1.5 rounded-lg transition-all duration-200" 
                            title="Tema cristalino">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a1 1 0 001 1h12a1 1 0 001-1V6a2 2 0 00-2-2H4zm12 12H4a2 2 0 01-2-2v-4a1 1 0 00-1-1H.5a.5.5 0 00-.5.5v4a4 4 0 004 4h12a4 4 0 004-4v-4a.5.5 0 00-.5-.5H17a1 1 0 00-1 1v4a2 2 0 01-2 2z" clip-rule="evenodd"></path></svg>
                        </button>
                    </div>

                    <!-- LOGOUT -->
                    <button 
                        @click="handleLogout()" 
                        class="flex items-center gap-2 bg-red-600/10 hover:bg-red-600 px-4 py-2 rounded-lg transition-all duration-200 text-red-500 hover:text-white border border-red-600/30 text-xs font-bold uppercase tracking-widest group"
                        title="Fazer logout">
                        <svg class="w-4 h-4 group-hover:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                        <span>Sair</span>
                    </button>

                    <!-- HAMBURGER MENU (Mobile) -->
                    <button 
                        @click="mobileMenuOpen = !mobileMenuOpen"
                        class="mobile-menu-toggle p-2"
                        title="Menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </nav>

            <!-- MAIN CONTENT -->
            <main class="p-8 max-w-[1600px] mx-auto fade-in">
                
                <!-- TAB: RELAT√ìRIOS -->
                <div x-show="tab === 'reports'">
                    <div class="mb-8">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h1 class="text-4xl font-black italic uppercase mb-2">Hub de Intelig√™ncia</h1>
                                <p class="text-sm opacity-60 font-bold uppercase tracking-widest">Dashboards e an√°lises Power BI</p>
                            </div>
                            <div class="text-4xl opacity-20">üìä</div>
                        </div>
                        <div class="flex gap-4 items-end flex-wrap">
                            <div class="relative flex-1 max-w-md">
                                <input type="text" x-model.debounce.300ms="searchQueryReports" placeholder="Filtrar relat√≥rios..." class="w-full pl-12 pr-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-xs outline-none focus:border-blue-500 transition" aria-label="Buscar relat√≥rios">
                                <span class="absolute left-4 top-3.5 opacity-30" aria-hidden="true">üîç</span>
                            </div>
                            <button @click="openReportCreateModal()" class="bg-blue-600 hover:bg-blue-700 transition px-6 py-3 rounded-2xl font-black text-xs uppercase text-white shadow-lg" title="Criar novo relat√≥rio">+ Novo Report</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="report in filteredReports" :key="report.id">
                            <div class="glass-container p-5 rounded-3xl hover:border-blue-500/70 hover:shadow-lg hover:shadow-blue-500/20 transition-all group cursor-pointer">
                                <h4 class="font-black text-lg mb-1 truncate" x-text="report.nome" :title="report.nome"></h4>
                                <span class="inline-block bg-blue-500/20 text-blue-300 px-2.5 py-1 rounded-lg text-xs font-bold uppercase tracking-wider mb-3" x-text="report.area"></span>
                                <p class="text-xs opacity-60 mb-5 line-clamp-2 h-9" x-text="report.descricao || 'Sem descri√ß√£o.'"></p>
                                <div class="flex gap-2">
                                    <a :href="report.link" target="_blank" rel="noopener noreferrer" class="flex-1 bg-blue-600 hover:bg-blue-700 text-center py-2.5 rounded-xl text-xs font-bold uppercase transition text-white" title="Abrir relat√≥rio em nova aba">Acessar</a>
                                    <button @click="openReportEditModal(report.id)" class="p-2 bg-white/5 hover:bg-blue-500/30 border border-white/10 rounded-xl transition" aria-label="Editar relat√≥rio" title="Editar">‚úèÔ∏è</button>
                                    <button x-show="isAdmin" @click="deleteReport(report.id)" class="p-2 bg-red-500/5 hover:bg-red-600 border border-red-500/20 rounded-xl transition" aria-label="Deletar relat√≥rio" title="Deletar">üóëÔ∏è</button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- TAB: USU√ÅRIOS -->
                <div x-show="tab === 'users'">
                    <div class="mb-8">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h1 class="text-4xl font-black italic uppercase mb-2">Gest√£o de Equipe</h1>
                                <p class="text-sm opacity-60 font-bold uppercase tracking-widest" x-text="`${usersList.length} colaboradorces`"></p>
                            </div>
                            <div class="text-4xl opacity-20">üë•</div>
                        </div>
                        <div class="flex gap-4 items-end flex-wrap">
                            <div class="relative flex-1 max-w-md">
                                <input type="text" x-model.debounce.300ms="searchQueryUsers" placeholder="Buscar colaborador..." class="w-full pl-12 pr-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-xs outline-none focus:border-blue-500 transition" aria-label="Buscar usu√°rios">
                                <span class="absolute left-4 top-3.5 opacity-30" aria-hidden="true">üîç</span>
                            </div>
                            <button @click="openUserCreateModal()" class="bg-blue-600 hover:bg-blue-700 transition px-6 py-3 rounded-2xl font-black text-xs uppercase text-white" title="Adicionar novo usu√°rio">+ Novo Usu√°rio</button>
                        </div>
                    </div>
                    <div class="glass-container rounded-[40px] overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-white/5 text-xs font-black uppercase border-b border-white/10">
                                <tr>
                                    <th class="p-8">Colaborador</th>
                                    <th class="p-8">Cargo / Setor</th>
                                    <th x-show="isAdmin" class="p-8 text-right">Gerenciar</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                <template x-for="user in filteredUsers" :key="user.email">
                                    <tr class="hover:bg-white/[0.02]">
                                        <td class="p-8">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center font-black text-xs text-white" x-text="user.nome_completo?.charAt(0)" :title="user.nome_completo"></div>
                                                <div>
                                                    <div class="font-bold text-sm" x-text="user.nome_completo"></div>
                                                    <div class="text-xs opacity-40" x-text="user.email"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-8">
                                            <div class="flex flex-col gap-2">
                                                <span class="inline-block w-fit bg-blue-500/20 text-blue-300 px-2.5 py-1 rounded-lg text-xs font-bold uppercase" x-text="user.cargo"></span>
                                                <span class="inline-block w-fit bg-slate-500/20 text-slate-300 px-2.5 py-1 rounded-lg text-xs font-bold uppercase" x-text="user.setor || 'GERAL'"></span>
                                            </div>
                                        </td>
                                        <td x-show="isAdmin" class="p-8 text-right">
                                            <div class="flex justify-end gap-2">
                                                <button @click="openUserEditModal(user.email)" class="p-2.5 bg-white/5 rounded-xl hover:bg-blue-600 transition" aria-label="Editar usu√°rio" title="Editar">‚úèÔ∏è</button>
                                                <button @click="deleteUser(user.email)" class="p-2.5 bg-white/5 rounded-xl hover:bg-red-600 transition" aria-label="Deletar usu√°rio" title="Deletar">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB: AUDITORIA -->
                <div x-show="tab === 'audit'">
                    <div class="mb-8">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h1 class="text-4xl font-black italic uppercase mb-2">Trilha de Auditoria</h1>
                                <p class="text-sm opacity-60 font-bold uppercase tracking-widest" x-text="`${auditLogs.length} registro(s)`"></p>
                            </div>
                            <div class="text-4xl opacity-20">üìã</div>
                        </div>
                        <div class="flex gap-2">
                            <select x-model="filterAuditAction" class="bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-[10px] font-black uppercase outline-none focus:border-blue-500 cursor-pointer" aria-label="Filtrar por a√ß√£o">
                                <option value="">Todas A√ß√µes</option>
                                <option value="CRIAR">Criar</option>
                                <option value="EDITAR">Editar</option>
                                <option value="DELETAR">Deletar</option>
                            </select>
                            <input type="text" x-model="searchQueryAudit" placeholder="Buscar no log..." class="bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs outline-none focus:border-blue-500 w-64" aria-label="Buscar nos logs">
                            <button @click="loadAuditLogs()" :disabled="isLoadingAudit" class="bg-white/5 hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed px-4 py-2 rounded-xl text-[10px] font-black transition uppercase" :title="isLoadingAudit ? 'Sincronizando...' : 'Recarregar logs de auditoria'">
                                <span x-text="isLoadingAudit ? '‚ü≥ Sincronizando...' : 'Sincronizar'"></span>
                            </button>
                        </div>
                    </div>
                    <div class="glass-container rounded-[40px] overflow-hidden">
                        <div class="max-h-[600px] overflow-y-auto p-6 space-y-3 custom-scroll">
                            <template x-for="log in filteredAuditLogs" :key="log.id">
                                <div class="p-6 bg-white/5 border border-white/5 rounded-2xl flex items-center gap-6">
                                    <div class="text-sm font-mono opacity-40 w-40 flex-shrink-0" x-text="formatDateTime(log.created_at)"></div>
                                    <div class="px-3 py-1.5 bg-blue-500/20 text-blue-300 font-bold text-xs rounded-lg uppercase flex-shrink-0" x-text="getHumanReadableAction(log.acao)"></div>
                                    <div class="flex-1 text-sm font-semibold opacity-80" x-text="log.alvo"></div>
                                    <div class="text-xs font-semibold opacity-50 italic" x-text="log.admin_email"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- TAB: PERFIL -->
                <div x-show="tab === 'profile'">
                    <div class="max-w-5xl mx-auto">
                        <div class="mb-8">
                            <div class="flex items-start justify-between mb-6">
                                <div>
                                    <h1 class="text-4xl font-black italic uppercase mb-2">Meu Perfil</h1>
                                    <p class="text-sm opacity-60 font-bold uppercase tracking-widest">Area restrita - Informacoes pessoais</p>
                                </div>
                                <div class="text-4xl opacity-20">üë§</div>
                            </div>
                        </div>
                        <div class="glass-container p-8 rounded-[40px] flex flex-col sm:flex-row items-start sm:items-center gap-8 mb-8">
                            <div class="w-32 h-32 flex-shrink-0 bg-gradient-to-tr from-blue-700 to-blue-400 rounded-full flex items-center justify-center text-5xl font-black shadow-lg text-white" x-text="currentUserData.nome_completo?.charAt(0) || 'U'"></div>
                            <div class="flex-1">
                                <h2 class="text-3xl font-black mb-2" x-text="currentUserData.nome_completo"></h2>
                                <div class="inline-block bg-blue-500/20 text-blue-300 px-3 py-1.5 rounded-lg text-sm font-bold uppercase tracking-wider mb-4" x-text="currentUserData.cargo"></div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5 hover:border-blue-500/30 transition">
                                        <p class="text-xs opacity-40 uppercase font-bold mb-1">E-mail Corporativo</p>
                                        <p class="font-semibold text-sm line-clamp-2" x-text="currentUserData.email"></p>
                                    </div>
                                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5 hover:border-blue-500/30 transition">
                                        <p class="text-xs opacity-40 uppercase font-bold mb-1">Setor Operacional</p>
                                        <p class="font-semibold text-sm" x-text="currentUserData.setor || 'N√£o informado'"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Atividades Recentes -->
                        <div class="glass-container p-8 rounded-[40px]">
                            <h3 class="text-2xl font-black mb-6 uppercase">üìã Atividades Recentes</h3>
                            <div class="space-y-3 max-h-[400px] overflow-y-auto custom-scroll">
                                <template x-if="recentActivityLogs.length === 0">
                                    <p class="text-sm opacity-50 text-center py-8">Nenhuma atividade registrada no sistema</p>
                                </template>
                                <template x-for="log in recentActivityLogs.slice(0, 10)" :key="log.id">
                                    <div class="p-4 bg-white/5 border border-white/5 rounded-xl hover:border-blue-500/30 transition">
                                        <div class="flex items-start justify-between gap-4">
                                            <div class="flex-1">
                                                <p class="font-semibold text-sm" x-text="getHumanReadableAction(log.acao)"></p>
                                                <p class="text-xs opacity-50 mt-1" x-text="log.alvo || 'N/A'"></p>
                                            </div>
                                            <p class="text-xs opacity-40 flex-shrink-0 whitespace-nowrap" x-text="formatDateTime(log.created_at)"></p>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: NOT√çCIAS -->
                <section x-show="tab === 'news'" class="max-w-5xl mx-auto" aria-labelledby="news-h1">
                    <div class="mb-8">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h1 class="text-4xl font-black italic uppercase mb-2">Novidades do Sistema</h1>
                                <p class="text-sm opacity-60 font-bold uppercase tracking-widest">√öltimas atualiza√ß√µes e melhorias | Impacto mede risco/benef√≠cio para usu√°rios finais</p>
                            </div>
                            <div class="text-4xl opacity-20">üì∞</div>
                        </div>
                    </div>

                <div class="mb-8 glass-container p-6 rounded-[32px] space-y-4">
                        <div>
                            <label for="news-search" class="text-xs font-black uppercase mb-2 block opacity-60">Buscar</label>
                            <input 
                                id="news-search"
                                type="text" 
                                x-model.debounce.300ms="searchQueryNews" 
                                placeholder="Busque por titulo ou descricao..."
                                class="w-full p-3 rounded-2xl bg-white/5 border border-white/10 text-white outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition text-sm"
                            >
                        </div>
                        <div>
                            <label class="text-xs font-black uppercase mb-2 block opacity-60">Filtrar por Impacto</label>
                            <div class="flex flex-wrap gap-2">
                                <button x-on:click="filterNewsImpacto = ''" :class="filterNewsImpacto === '' ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/30' : 'bg-white/5 text-slate-300 border border-white/10'" class="px-3 py-1.5 rounded-full text-xs font-black uppercase transition">Todos</button>
                                <button x-on:click="filterNewsImpacto = 'Alto'" :class="filterNewsImpacto === 'Alto' ? 'bg-orange-600 text-white shadow-lg shadow-orange-600/30' : 'bg-white/5 text-slate-300 border border-white/10'" class="px-3 py-1.5 rounded-full text-xs font-black uppercase transition">Alto</button>
                                <button x-on:click="filterNewsImpacto = 'Medio'" :class="filterNewsImpacto === 'Medio' ? 'bg-yellow-600 text-white shadow-lg shadow-yellow-600/30' : 'bg-white/5 text-slate-300 border border-white/10'" class="px-3 py-1.5 rounded-full text-xs font-black uppercase transition">Medio</button>
                                <button x-on:click="filterNewsImpacto = 'Baixo'" :class="filterNewsImpacto === 'Baixo' ? 'bg-green-600 text-white shadow-lg shadow-green-600/30' : 'bg-white/5 text-slate-300 border border-white/10'" class="px-3 py-1.5 rounded-full text-xs font-black uppercase transition">Baixo</button>
                            </div>
                        </div>
                    </div>

                    <div x-show="newsList.length === 0" class="glass-container p-12 rounded-[40px] text-center">
                        <p class="opacity-50 font-bold">Nenhuma not√≠cia dispon√≠vel</p>
                    </div>

                    <div class="space-y-4">
                        <template x-for="(news, idx) in filteredNewsItems" :key="news.id">
                            <article 
                                class="glass-container p-6 rounded-[32px] border-l-[6px] hover:shadow-lg transition-all duration-300"
                                :class="{
                                    'border-orange-500': news.impacto === 'Alto',
                                    'border-yellow-500': news.impacto === 'Medio',
                                    'border-green-500': news.impacto === 'Baixo',
                                    'border-blue-600': !news.impacto
                                }"
                                :aria-labelledby="'news-title-' + news.id"
                                role="article"
                            >
                                <div class="flex items-start gap-4 mb-3">
                                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-black text-xs shadow-lg">
                                        <span x-show="idx === 0" title="Atualizacao mais recente">NEW</span>
                                        <span x-show="idx !== 0" x-text="idx + 1" :title="'Atualizacao ' + (idx + 1)"></span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h2 :id="'news-title-' + news.id" class="text-lg font-black uppercase tracking-tight" x-text="news.titulo"></h2>
                                    </div>
                                </div>

                                <div class="mb-3 ml-12">
                                    <p 
                                        class="opacity-75 leading-relaxed text-sm"
                                        :class="news._expanded ? '' : 'line-clamp-3'"
                                        x-text="news.conteudo"
                                    ></p>
                                    <button 
                                        x-show="news.conteudo && news.conteudo.split(' ').length > 30"
                                        @click="toggleNewsExpand(news.id)"
                                        class="text-xs text-blue-400 hover:text-blue-300 font-bold mt-2 uppercase transition"
                                        :aria-expanded="news._expanded"
                                    >
                                        <span x-text="news._expanded ? 'Ver menos' : 'Ver mais'"></span>
                                    </button>
                                </div>

                                <div class="ml-12 space-y-3">
                                    <div class="flex flex-wrap gap-2">
                                        <button 
                                            @click="copyToClipboard('news/' + news.id)" 
                                            title="Clique para copiar link"
                                            class="text-xs font-black bg-blue-600/20 text-blue-400 px-2.5 py-1 rounded-full border border-blue-500/30 uppercase tracking-widest hover:bg-blue-600/40 transition cursor-pointer"
                                        >
                                            <span x-text="'v' + news.versao"></span>
                                        </button>
                                        
                                        <button 
                                            x-show="news.categoria"
                                            @click="filterNewsArea = news.categoria"
                                            :class="getAffiliationColor(news.categoria)"
                                            class="text-xs font-black px-2.5 py-1 rounded-full border uppercase tracking-widest cursor-pointer"
                                        >
                                            <span x-text="news.categoria"></span>
                                        </button>
                                    </div>

                                    <div class="flex items-center justify-between text-xs">
                                        <div class="flex gap-2 items-center">
                                            <span 
                                                x-show="news.impacto"
                                                class="px-2.5 py-1 rounded-lg font-bold uppercase tracking-wider border flex items-center gap-1"
                                                :class="{
                                                    'bg-orange-500/20 text-orange-300 border-orange-500/30': news.impacto === 'Alto',
                                                    'bg-yellow-500/20 text-yellow-300 border-yellow-500/30': news.impacto === 'Medio',
                                                    'bg-green-500/20 text-green-300 border-green-500/30': news.impacto === 'Baixo'
                                                }"
                                            >
                                                <span x-text="news.impacto"></span>
                                            </span>
                                        </div>
                                        <div class="flex gap-3 items-center">
                                            <time class="opacity-40 font-mono text-[10px]" :title="new Date(news.created_at).toLocaleString('pt-BR')" x-text="formatDateTime(news.created_at)"></time>
                                            <div x-show="news.status" class="font-bold uppercase tracking-widest" :class="news.status === 'ativo' ? 'text-green-400' : 'text-slate-400'">
                                                <span x-text="news.status"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </template>
                    </div>

                    <div class="text-center mt-8 text-sm opacity-60">
                        <span x-text="`${filteredNewsItems.length} de ${newsList.length} noticias`"></span>
                    </div>
                </div>
            </main>

            <!-- MODAL: RELAT√ìRIOS -->
            <div x-show="showReportModal" x-cloak class="fixed inset-0 bg-black/90 backdrop-blur-xl z-[60] flex items-center justify-center p-4">
                <div class="glass-container p-10 rounded-[40px] w-full max-w-lg" @click.stop>
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-2xl font-black uppercase tracking-tighter text-white" x-text="modalMode === 'create' ? 'Novo Relat√≥rio' : 'Editar Relat√≥rio'"></h2>
                        <button @click="showReportModal = false" class="text-white opacity-50 hover:opacity-100 text-2xl">‚úï</button>
                    </div>
                    
                    <div class="space-y-5">
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">T√≠tulo do Relat√≥rio</label>
                            <input type="text" x-model="formReport.nome" placeholder="Ex: An√°lise de Vendas" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Departamento</label>
                            <input type="text" x-model="formReport.area" placeholder="Ex: Finance" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Link do Power BI</label>
                            <input type="url" x-model="formReport.link" placeholder="https://app.powerbi.com/..." class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Descri√ß√£o</label>
                            <textarea x-model="formReport.descricao" placeholder="Descreva brevemente..." class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white h-20 focus:border-blue-500 outline-none transition resize-none" maxlength="500"></textarea>
                            <p class="text-[10px] opacity-40 mt-1" x-text="(formReport.descricao || '').length + ' / 500'"></p>
                        </div>
                        
                        <div class="flex gap-3 pt-4">
                            <button @click="showReportModal = false" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-white font-bold transition">Cancelar</button>
                            <button @click="saveReport()" class="flex-1 px-4 py-3 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-black transition">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL: USU√ÅRIOS -->
            <div x-show="showUserModal" x-cloak class="fixed inset-0 bg-black/90 backdrop-blur-xl z-[60] flex items-center justify-center p-4">
                <div class="glass-container p-10 rounded-[40px] w-full max-w-lg" @click.stop>
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-2xl font-black uppercase tracking-tighter text-white" x-text="modalMode === 'create' ? 'Novo Usu√°rio' : 'Editar Usu√°rio'"></h2>
                        <button @click="showUserModal = false" class="text-white opacity-50 hover:opacity-100 text-2xl">‚úï</button>
                    </div>
                    
                    <div class="space-y-5">
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Nome Completo</label>
                            <input type="text" x-model="formUser.nome_completo" placeholder="Ex: Jo√£o Silva" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">E-mail Corporativo</label>
                            <input type="email" x-model="formUser.email" placeholder="usuario@empresa.com" :disabled="modalMode === 'edit'" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition disabled:opacity-50">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Cargo</label>
                            <input type="text" x-model="formUser.cargo" placeholder="Ex: CEO, Diretor, Analista" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Setor (opcional)</label>
                            <input type="text" x-model="formUser.setor" placeholder="Ex: Financeiro" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white focus:border-blue-500 outline-none transition">
                        </div>
                        
                        <div class="flex gap-3 pt-4">
                            <button @click="showUserModal = false" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-white font-bold transition">Cancelar</button>
                            <button @click="saveUser()" class="flex-1 px-4 py-3 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-black transition">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL: RESET DE SENHA -->
            <div x-show="showResetPasswordModal" x-cloak class="fixed inset-0 bg-black/95 backdrop-blur-2xl z-[80] flex items-center justify-center p-4">
                <div class="glass-container p-12 rounded-[50px] w-full max-w-md" @click.stop>
                    <h2 class="text-2xl font-black mb-6 uppercase text-white text-center">Nova Senha</h2>
                    <p class="text-xs opacity-50 mb-8 uppercase font-bold text-center">M√≠nimo 6 caracteres</p>
                    
                    <div class="space-y-5">
                        <div>
                            <label class="block text-xs font-black uppercase mb-2 opacity-50">Nova Senha</label>
                            <input type="password" x-model="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white outline-none focus:border-blue-500 transition" minlength="6">
                        </div>
                        
                        <div class="flex gap-3">
                            <button @click="showResetPasswordModal = false; newPassword = ''" class="flex-1 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-white font-bold transition">Cancelar</button>
                            <button @click="updatePassword()" class="flex-1 px-4 py-3 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-black transition">Salvar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </template>

    <!-- SUPABASE CLIENT INITIALIZATION -->
    <script>
        // ============================================
        // CONFIGURA√á√ÉO SUPABASE
        // ============================================
        const SUPABASE_URL = 'https://nqdlxiyzsxkntypyzkie.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xZGx4aXl6c3hrbnR5cHl6a2llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NjY1ODIsImV4cCI6MjA4NzU0MjU4Mn0.8npxzHMR3VdaufiqmsJKdLR2zpXDOFzDldFwdth18f0';
        
        console.warn('‚ö†Ô∏è SEGURAN√áA: Em produ√ß√£o, use vari√°veis de ambiente em vez de credenciais hardcoded.');
        
        let supabaseClient = null;
        
        // Aguarda Supabase e cria cliente
        function initSupabaseClient() {
            if (typeof supabase !== 'undefined') {
                try {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    window.__SUPABASE_CLIENT = supabaseClient; // Para acesso global
                    console.log('‚úÖ Supabase cliente iniciado com sucesso');
                } catch (err) {
                    console.error('‚ùå Erro ao criar cliente:', err);
                }
            } else {
                setTimeout(initSupabaseClient, 100);
            }
        }
        
        initSupabaseClient();
    </script>

    <!-- FUN√á√ÉO HELPER DE FORMATA√á√ÉO -->
    <script>
        /**
         * Formata data para locale string
         */
        function formatDateTime(date) {
            try {
                return new Date(date).toLocaleString('pt-BR');
            } catch {
                return 'Data/hora inv√°lida';
            }
        }

        /**
         * Valida se √© email v√°lido
         */
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email).toLowerCase());
        }

        /**
         * Valida se √© URL v√°lida
         */
        function isValidUrl(url) {
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }

        /**
         * Traduz a√ß√µes de auditoria para linguagem humana
         */
        function getHumanReadableAction(action) {
            const translations = {
                'CRIAR': 'Cria√ß√£o',
                'EDITAR': 'Edi√ß√£o',
                'DELETAR': 'Exclus√£o',
                'CRIAR_USUARIO': 'Cria√ß√£o de Usu√°rio',
                'EDITAR_USUARIO': 'Edi√ß√£o de Usu√°rio',
                'DELETAR_USUARIO': 'Exclus√£o de Usu√°rio',
                'CRIAR_REPORT': 'Cria√ß√£o de Relat√≥rio',
                'EDITAR_REPORT': 'Edi√ß√£o de Relat√≥rio',
                'DELETAR_REPORT': 'Exclus√£o de Relat√≥rio',
                'LOGIN': 'Acesso ao Sistema',
                'LOGOUT': 'Sa√≠da do Sistema',
                'ATUALIZAR_PERFIL': 'Atualiza√ß√£o de Perfil'
            };
            return translations[action] || action;
        }
    </script>

    <!-- L√ìGICA PRINCIPAL - ALPINE.JS STORE -->
    <script>
        /**
         * Store principal da aplica√ß√£o
         * Gerencia estado, eventos e integra√ß√µes com Supabase
         */
        function systemCore() {
            return {
                // ============================================
                // ESTADO GERAL
                // ============================================
                initialized: false,
                view: 'login',
                tab: 'news',
                theme: localStorage.getItem('heuriskien_theme') || 'dark',
                userEmail: '',
                isAdmin: false,
                currentUserData: {},

                // FORMUL√ÅRIOS
                email: '',
                password: '',
                newPassword: '',
                formReport: { nome: '', area: '', link: '', descricao: '' },
                formUser: { nome_completo: '', email: '', cargo: '', setor: '' },

                // DADOS
                reportsList: [],
                usersList: [],
                auditLogs: [],
                recentActivityLogs: [],
                newsList: [],

                // BUSCA E FILTROS
                searchQueryUsers: '',
                searchQueryReports: '',
                searchQueryAudit: '',
                filterAuditAction: '',

                // UI STATE
                showReportModal: false,
                showUserModal: false,
                showResetPasswordModal: false,
                mobileMenuOpen: false,
                modalMode: 'create',
                
                // LOADING STATES
                isLoadingLogin: false,
                isLoadingReports: false,
                isLoadingUsers: false,
                isLoadingAudit: false,
                isLoadingProfile: false,
                lastSyncTime: null,

                // ============================================
                // INIT
                // ============================================
                async init() {
                    try {
                        console.log('üöÄ Iniciando Heuriskien...');

                        // Aguarda Supabase estar pronto
                        let attempts = 0;
                        while (!supabaseClient && attempts < 50) {
                            await new Promise(r => setTimeout(r, 100));
                            attempts++;
                        }

                        if (!supabaseClient) {
                            throw new Error('Supabase n√£o carregou em tempo h√°bil');
                        }

                        console.log('‚úÖ Cliente Supabase pronto');

                        // Registra listener de auth
                        supabaseClient.auth.onAuthStateChange(async (event, session) => {
                            console.log('üîê Auth event:', event);
                            if (event === 'PASSWORD_RECOVERY' || window.location.hash.includes('type=recovery')) {
                                this.view = 'dashboard';
                                this.showResetPasswordModal = true;
                            }
                        });

                        // Verifica sess√£o
                        const { data: { session }, error } = await supabaseClient.auth.getSession();
                        if (error) throw error;

                        if (session) {
                            this.userEmail = session.user.email;
                            await this.loadInitialData();
                            this.view = 'dashboard';
                            console.log('‚úÖ Usu√°rio autenticado:', this.userEmail);
                        } else {
                            this.view = 'login';
                            console.log('üë§ Exibindo tela de login');
                        }
                    } catch (err) {
                        console.error('‚ùå Erro de inicializa√ß√£o:', err);
                        Swal.fire('Erro', 'Falha ao inicializar: ' + err.message, 'error');
                        this.view = 'login';
                    } finally {
                        this.initialized = true;
                    }
                },

                // ============================================
                // AUTENTICA√á√ÉO
                // ============================================
                async handleLogin() {
                    try {
                        if (!this.email || !this.password) {
                            Swal.fire('Aviso', 'Preencha e-mail e senha.', 'warning');
                            return;
                        }

                        if (!isValidEmail(this.email)) {
                            Swal.fire('Aviso', 'E-mail inv√°lido.', 'warning');
                            return;
                        }

                        if (!supabaseClient) {
                            Swal.fire('Erro', 'Supabase n√£o est√° dispon√≠vel. Recarregue a p√°gina.', 'error');
                            return;
                        }

                        console.log('üîí Tentando login:', this.email);

                        const { error, data } = await supabaseClient.auth.signInWithPassword({
                            email: this.email.trim().toLowerCase(),
                            password: this.password,
                        });

                        if (error) {
                            console.error('‚ùå Erro de autentica√ß√£o:', error);
                            throw error;
                        }

                        console.log('‚úÖ Login bem sucedido');
                        window.location.reload();
                    } catch (err) {
                        console.error('‚ùå Erro de login:', err);
                        const msg = err?.message?.includes('Invalid login credentials') 
                            ? 'E-mail ou senha incorretos' 
                            : err?.message || 'Erro ao fazer login';
                        Swal.fire('Erro', msg, 'error');
                    }
                },

                async recoverPassword() {
                    const { value: email } = await Swal.fire({
                        title: 'Recuperar Senha',
                        input: 'email',
                        inputPlaceholder: 'seu@email.com',
                        inputValidator: (value) => {
                            if (!value) return 'E-mail √© obrigat√≥rio';
                            if (!isValidEmail(value)) return 'E-mail inv√°lido';
                        },
                        background: '#030712',
                        color: '#fff',
                        confirmButtonText: 'Enviar Link',
                    });

                    if (email) {
                        try {
                            console.log('üìß Enviando recupera√ß√£o:', email);

                            const { error } = await supabaseClient.auth.resetPasswordForEmail(
                                email.trim().toLowerCase(),
                                {
                                    redirectTo: window.location.origin + window.location.pathname,
                                }
                            );

                            if (error) throw error;

                            Swal.fire('Sucesso!', 'Verifique seu e-mail.', 'success');
                        } catch (err) {
                            console.error('‚ùå Erro:', err);
                            Swal.fire('Erro', err.message || 'Falha ao enviar.', 'error');
                        }
                    }
                },

                async updatePassword() {
                    try {
                        if (!this.newPassword || this.newPassword.length < 6) {
                            Swal.fire('Aviso', 'M√≠nimo 6 caracteres.', 'warning');
                            return;
                        }

                        console.log('üîê Atualizando senha...');

                        const { error } = await supabaseClient.auth.updateUser({
                            password: this.newPassword,
                        });

                        if (error) throw error;

                        await Swal.fire('Sucesso!', 'Senha alterada.', 'success');
                        await this.handleLogout();
                    } catch (err) {
                        console.error('‚ùå Erro:', err);
                        Swal.fire('Erro', err.message, 'error');
                    }
                },

                async handleLogout() {
                    try {
                        console.log('üëã Fazendo logout...');
                        await supabaseClient.auth.signOut();
                        window.location.reload();
                    } catch (err) {
                        console.error('‚ùå Erro:', err);
                        window.location.reload();
                    }
                },

                // ============================================
                // CARREGAMENTO DE DADOS COM CACHE
                // ============================================
                async loadInitialData() {
                    try {
                        const client = supabaseClient;
                        
                        // Tenta cache primeiro
                        const cachedReports = localStorage.getItem('cache_reports');
                        const cachedUsers = localStorage.getItem('cache_users');
                        const cachedNews = localStorage.getItem('cache_news');

                        // Carrega dados em paralelo
                        const [profile, reports, users, news] = await Promise.all([
                            this.loadProfile(),
                            this.loadReports(cachedReports),
                            this.loadUsers(cachedUsers),
                            this.loadNews(cachedNews)
                        ]);

                        // Carrega auditoria se admin
                        if (this.isAdmin) {
                            await this.loadAuditLogs();
                        }

                        this.lastSyncTime = new Date().toLocaleTimeString('pt-BR');
                        console.log('‚úÖ Dados carregados com sucesso');
                    } catch (err) {
                        console.error('‚ùå Erro ao carregar dados:', err);
                        Swal.fire('Erro', 'Falha ao sincronizar dados. Tente novamente.', 'error');
                    }
                },

                async loadProfile() {
                    try {
                        const { data: profile } = await supabaseClient
                            .from('acessTable')
                            .select('*')
                            .ilike('email', this.userEmail)
                            .maybeSingle();

                        if (profile) {
                            this.currentUserData = profile;
                            this.isAdmin = ['CEO', 'Diretor'].includes(profile.cargo);
                            localStorage.setItem('cache_profile', JSON.stringify(profile));
                        }
                        return profile;
                    } catch (err) {
                        console.error('‚ùå Erro ao carregar perfil:', err);
                        return null;
                    }
                },

                async loadReports(cached = null) {
                    try {
                        this.isLoadingReports = true;
                        
                        // Se tem cache v√°lido, usa primeiro
                        if (cached) {
                            this.reportsList = JSON.parse(cached);
                        }

                        // Depois atualiza do Supabase
                        const { data: reports } = await supabaseClient
                            .from('reportsTable')
                            .select('*')
                            .order('nome');
                            
                        if (reports) {
                            this.reportsList = reports;
                            localStorage.setItem('cache_reports', JSON.stringify(reports));
                            localStorage.setItem('cache_reports_time', Date.now().toString());
                        }
                    } catch (err) {
                        console.error('‚ùå Erro ao carregar relat√≥rios:', err);
                    } finally {
                        this.isLoadingReports = false;
                    }
                },

                async loadUsers(cached = null) {
                    try {
                        this.isLoadingUsers = true;
                        
                        if (cached) {
                            this.usersList = JSON.parse(cached);
                        }

                        const { data: users } = await supabaseClient
                            .from('acessTable')
                            .select('*')
                            .order('nome_completo');
                            
                        if (users) {
                            this.usersList = users;
                            localStorage.setItem('cache_users', JSON.stringify(users));
                        }
                    } catch (err) {
                        console.error('‚ùå Erro ao carregar usu√°rios:', err);
                    } finally {
                        this.isLoadingUsers = false;
                    }
                },

                async loadNews(cached = null) {
                    try {
                        if (cached) {
                            this.newsList = JSON.parse(cached);
                        }

                        const { data: news, error } = await supabaseClient
                            .from('newsTable')
                            .select('id, created_at, titulo, conteudo, versao, categoria, impacto, status')
                            .order('created_at', { ascending: false })
                            .limit(20);
                            
                        if (error) {
                            console.error('‚ùå Erro ao buscar not√≠cias:', error);
                            return;
                        }
                            
                        if (news && news.length > 0) {
                            // Processa dados para garantir formato correto
                            this.newsList = news.map(n => ({
                                id: n.id,
                                titulo: n.titulo || 'Sem t√≠tulo',
                                conteudo: n.conteudo || 'Sem conte√∫do',
                                versao: n.versao || 'N/A',
                                categoria: n.categoria || null,
                                impacto: n.impacto || null,
                                status: n.status || 'ativo',
                                created_at: n.created_at
                            }));
                            localStorage.setItem('cache_news', JSON.stringify(this.newsList));
                            console.log('‚úÖ ' + this.newsList.length + ' not√≠cias carregadas');
                        } else {
                            this.newsList = [];
                            console.log('üìÑ Nenhuma not√≠cia encontrada na tabela');
                        }
                    } catch (err) {
                        console.error('‚ùå Erro ao carregar not√≠cias:', err);
                        if (cached) {
                            this.newsList = JSON.parse(cached);
                        } else {
                            this.newsList = [];
                        }
                    }
                },

                // ============================================
                // ESTADO PARA NOT√çCIAS
                // ============================================
                searchQueryNews: '',
                filterNewsImpacto: '',
                filterNewsArea: '',
                newsExpandedIds: new Set(),

                toggleNewsExpand(newsId) {
                    if (this.newsExpandedIds.has(newsId)) {
                        this.newsExpandedIds.delete(newsId);
                    } else {
                        this.newsExpandedIds.add(newsId);
                    }
                    // Force Alpine to detect this change
                    this.$nextTick(() => {
                        this.$refresh();
                    });
                },

                getAffiliationColor(categoria) {
                    if (!categoria) return 'bg-slate-700/40 text-slate-200 border-slate-600/30';
                    const colors = {
                        'Qualidade': 'bg-purple-600/20 text-purple-300 border-purple-500/30',
                        'Backend': 'bg-indigo-600/20 text-indigo-300 border-indigo-500/30',
                        'Produto': 'bg-blue-600/20 text-blue-400 border-blue-500/30'
                    };
                    return colors[categoria] || 'bg-slate-700/40 text-slate-200 border-slate-600/30';
                },

                copyToClipboard(text) {
                    navigator.clipboard.writeText(window.location.origin + '?id=' + text).then(() => {
                        Swal.fire('Copiado!', 'Link copiado para √°rea de transfer√™ncia', 'success');
                    }).catch(() => {
                        Swal.fire('Erro', 'N√£o foi poss√≠vel copiar o link', 'error');
                    });
                },

                get filteredNewsItems() {
                    let filtered = this.newsList.map(news => ({
                        ...news,
                        _expanded: this.newsExpandedIds.has(news.id)
                    }));
                    
                    // Filtro de search
                    if (this.searchQueryNews) {
                        const q = this.searchQueryNews.toLowerCase();
                        filtered = filtered.filter(n =>
                            n.titulo?.toLowerCase().includes(q) ||
                            n.conteudo?.toLowerCase().includes(q)
                        );
                    }
                    
                    // Filtro de impacto
                    if (this.filterNewsImpacto) {
                        filtered = filtered.filter(n => n.impacto === this.filterNewsImpacto);
                    }
                    
                    // Filtro de √°rea
                    if (this.filterNewsArea) {
                        filtered = filtered.filter(n => n.categoria === this.filterNewsArea);
                    }
                    
                    return filtered;
                },

                // ============================================
                // FILTROS
                // ============================================
                get filteredReports() {
                    const q = this.searchQueryReports.toLowerCase();
                    return q
                        ? this.reportsList.filter(
                            (r) =>
                                r.nome?.toLowerCase().includes(q) ||
                                r.area?.toLowerCase().includes(q)
                        )
                        : this.reportsList;
                },

                get filteredUsers() {
                    const q = this.searchQueryUsers.toLowerCase();
                    return q
                        ? this.usersList.filter(
                            (u) =>
                                u.nome_completo?.toLowerCase().includes(q) ||
                                u.email?.toLowerCase().includes(q)
                        )
                        : this.usersList;
                },

                get filteredAuditLogs() {
                    const q = this.searchQueryAudit.toLowerCase();
                    const action = this.filterAuditAction;
                    return this.auditLogs.filter((log) => {
                        const matches = !q ||
                            String(log.acao || '').toLowerCase().includes(q) ||
                            String(log.alvo || '').toLowerCase().includes(q) ||
                            String(log.admin_email || '').toLowerCase().includes(q);
                        const actionMatch = !action || String(log.acao || '').includes(action);
                        return matches && actionMatch;
                    });
                },

                // ============================================
                // RELAT√ìRIOS
                // ============================================
                async openReportModal(mode, reportId = null) {
                    this.modalMode = mode;
                    if (mode === 'create') {
                        this.formReport = { nome: '', area: '', link: '', descricao: '' };
                    } else if (reportId) {
                        const report = this.reportsList.find(r => r.id === reportId);
                        this.formReport = report ? JSON.parse(JSON.stringify(report)) : { nome: '', area: '', link: '', descricao: '' };
                    }
                    this.showReportModal = true;
                },

                // ============================================
                // FUN√á√ïES AUXILIARES PARA ABRIR MODAIS
                // ============================================
                
                openReportCreateModal() {
                    console.log('üîì Abrindo modal de novo relat√≥rio');
                    this.modalMode = 'create';
                    this.formReport = { nome: '', area: '', link: '', descricao: '' };
                    this.showReportModal = true;
                    console.log('‚úÖ showReportModal:', this.showReportModal);
                },

                openReportEditModal(reportId) {
                    console.log('üîì Abrindo modal de edi√ß√£o para relat√≥rio:', reportId);
                    const report = this.reportsList.find(r => r.id === reportId);
                    if (report) {
                        this.modalMode = 'edit';
                        this.formReport = JSON.parse(JSON.stringify(report));
                        this.showReportModal = true;
                        console.log('‚úÖ showReportModal:', this.showReportModal, 'formReport:', this.formReport);
                    } else {
                        console.error('‚ùå Relat√≥rio n√£o encontrado:', reportId);
                    }
                },

                openUserCreateModal() {
                    console.log('üîì Abrindo modal de novo usu√°rio');
                    this.modalMode = 'create';
                    this.formUser = { nome_completo: '', email: '', cargo: '', setor: '' };
                    this.showUserModal = true;
                    console.log('‚úÖ showUserModal:', this.showUserModal);
                },

                openUserEditModal(userEmail) {
                    console.log('üîì Abrindo modal de edi√ß√£o para usu√°rio:', userEmail);
                    const user = this.usersList.find(u => u.email === userEmail);
                    if (user) {
                        this.modalMode = 'edit';
                        this.formUser = JSON.parse(JSON.stringify(user));
                        this.showUserModal = true;
                        console.log('‚úÖ showUserModal:', this.showUserModal, 'formUser:', this.formUser);
                    } else {
                        console.error('‚ùå Usu√°rio n√£o encontrado:', userEmail);
                    }
                },

                async saveReport() {
                    try {
                        if (!this.formReport.nome || !this.formReport.area || !this.formReport.link) {
                            Swal.fire('Aviso', 'Preencha todos os campos obrigat√≥rios.', 'warning');
                            return;
                        }

                        if (!isValidUrl(this.formReport.link)) {
                            Swal.fire('Aviso', 'URL inv√°lida.', 'warning');
                            return;
                        }

                        const client = supabaseClient;
                        let payload = JSON.parse(JSON.stringify(this.formReport));

                        const toast = Swal.fire({
                            title: 'Salvando...',
                            allowOutsideClick: false,
                            didOpen: async () => {
                                Swal.showLoading();
                                try {
                                    if (this.modalMode === 'create') {
                                        delete payload.id;
                                        await client.from('reportsTable').insert([payload]);
                                    } else {
                                        const { id, ...update } = payload;
                                        await client.from('reportsTable').update(update).eq('id', id);
                                    }
                                    
                                    // Limpa cache
                                    localStorage.removeItem('cache_reports');
                                    
                                    this.showReportModal = false;
                                    await this.loadInitialData();
                                    
                                    Swal.fire('Sucesso!', 'Relat√≥rio salvo com sucesso.', 'success');
                                } catch (err) {
                                    Swal.fire('Erro', 'Falha ao salvar: ' + err.message, 'error');
                                }
                            }
                        });
                    } catch (err) {
                        console.error('‚ùå Erro:', err);
                        Swal.fire('Erro', 'Falha ao processar.', 'error');
                    }
                },

                async deleteReport(id) {
                    const confirm = await Swal.fire({
                        title: 'Confirmar exclus√£o?',
                        text: 'N√£o pode ser desfeito.',
                        icon: 'warning',
                        showCancelButton: true,
                        background: '#030712',
                        color: '#fff',
                        confirmButtonColor: '#dc2626',
                    });

                    if (confirm.isConfirmed) {
                        try {
                            await supabaseClient.from('reportsTable').delete().eq('id', id);
                            await this.loadInitialData();
                            Swal.fire('Sucesso!', 'Relat√≥rio removido.', 'success');
                        } catch (err) {
                            Swal.fire('Erro', 'Falha ao remover.', 'error');
                        }
                    }
                },

                // ============================================
                // USU√ÅRIOS
                // ============================================
                async openUserModal(mode, userEmail = null) {
                    this.modalMode = mode;
                    if (mode === 'create') {
                        this.formUser = { nome_completo: '', email: '', cargo: '', setor: '' };
                    } else if (userEmail) {
                        const user = this.usersList.find(u => u.email === userEmail);
                        this.formUser = user ? JSON.parse(JSON.stringify(user)) : { nome_completo: '', email: '', cargo: '', setor: '' };
                    }
                    this.showUserModal = true;
                },

                async saveUser() {
                    try {
                        if (!this.formUser.nome_completo || !this.formUser.email || !this.formUser.cargo) {
                            Swal.fire('Aviso', 'Preencha campos obrigat√≥rios.', 'warning');
                            return;
                        }

                        if (!isValidEmail(this.formUser.email)) {
                            Swal.fire('Aviso', 'E-mail inv√°lido.', 'warning');
                            return;
                        }

                        const client = supabaseClient;
                        const payload = JSON.parse(JSON.stringify(this.formUser));

                        Swal.fire({
                            title: 'Salvando...',
                            allowOutsideClick: false,
                            didOpen: async () => {
                                Swal.showLoading();
                                try {
                                    if (this.modalMode === 'create') {
                                        await client.from('acessTable').insert([payload]);
                                    } else {
                                        await client.from('acessTable').update(payload).eq('email', payload.email);
                                    }

                                    localStorage.removeItem('cache_users');
                                    this.showUserModal = false;
                                    await this.loadInitialData();
                                    Swal.fire('Sucesso!', 'Usu√°rio salvo com sucesso.', 'success');
                                } catch (err) {
                                    Swal.fire('Erro', 'Falha ao salvar: ' + err.message, 'error');
                                }
                            }
                        });
                    } catch (err) {
                        console.error('‚ùå Erro:', err);
                        Swal.fire('Erro', 'Falha ao processar.', 'error');
                    }
                },

                async deleteUser(email) {
                    const confirm = await Swal.fire({
                        title: 'Confirmar remo√ß√£o?',
                        text: 'N√£o pode ser desfeito.',
                        icon: 'warning',
                        showCancelButton: true,
                        background: '#030712',
                        color: '#fff',
                        confirmButtonColor: '#dc2626',
                    });

                    if (confirm.isConfirmed) {
                        try {
                            await supabaseClient.from('acessTable').delete().eq('email', email);
                            await this.loadInitialData();
                            Swal.fire('Sucesso!', 'Usu√°rio removido.', 'success');
                        } catch (err) {
                            Swal.fire('Erro', 'Falha ao remover.', 'error');
                        }
                    }
                },

                async loadAuditLogs() {
                    try {
                        this.isLoadingAudit = true;
                        const { data } = await supabaseClient
                            .from('audit_logs')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(100);
                        this.auditLogs = data || [];
                        this.recentActivityLogs = (data || []).slice(0, 10);
                        localStorage.setItem('cache_audit', JSON.stringify(data));
                    } catch (err) {
                        console.error('‚ùå Erro ao carregar logs:', err);
                        Swal.fire('Erro', 'Falha ao sincronizar auditoria.', 'error');
                    } finally {
                        this.isLoadingAudit = false;
                    }
                },
            };
        }
    </script>

    <!-- AVISO DE MANUTEN√á√ÉO -->
    <script>
        console.warn(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         üöß REFATORA√á√ÉO EM PROGRESSO                         ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                             ‚ïë
‚ïë Este index.html foi refatorado para separar:               ‚ïë
‚ïë  ‚úÖ CSS ‚Üí css/styles.css                                   ‚ïë
‚ïë  ‚úÖ Config ‚Üí js/config.js                                  ‚ïë
‚ïë  ‚úÖ Utils ‚Üí js/utils.js                                    ‚ïë
‚ïë  ‚úÖ Supabase ‚Üí js/supabase.js                              ‚ïë
‚ïë  ‚úÖ App Logic ‚Üí js/app.js                                  ‚ïë
‚ïë                                                             ‚ïë
‚ïë PR√ìXIMOS PASSOS:                                            ‚ïë
‚ïë  1. Instale um bundler (Vite recomendado)                  ‚ïë
‚ïë  2. Configure import maps ou use module-based imports      ‚ïë
‚ïë  3. Coloque o c√≥digo inline com refer√™ncias dos m√≥dulos    ‚ïë
‚ïë  4. Configure vari√°veis de ambiente (.env.local)           ‚ïë
‚ïë                                                             ‚ïë
‚ïë ARQUIVOS CRIADOS:                                           ‚ïë
‚ïë  ‚Ä¢ .env.example (copie para .env.local)                    ‚ïë
‚ïë  ‚Ä¢ .gitignore                                              ‚ïë
‚ïë  ‚Ä¢ js/config.js                                            ‚ïë
‚ïë  ‚Ä¢ js/utils.js                                             ‚ïë
‚ïë  ‚Ä¢ js/supabase.js                                          ‚ïë
‚ïë  ‚Ä¢ js/app.js                                               ‚ïë
‚ïë  ‚Ä¢ css/styles.css                                          ‚ïë
‚ïë  ‚Ä¢ README.md (pr√≥ximo passo)                               ‚ïë
‚ïë                                                             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        `);
    </script>
</body>
</html>
